# Build and Tag Action

ä¸€ä¸ªç”¨äºåœ¨åˆ†æ”¯ä¸Šè‡ªåŠ¨åˆ›å»ºå¸¦æ—¥æœŸç‰ˆæœ¬æ ‡ç­¾çš„ GitHub Actionï¼Œå·²å¢å¼ºå¹¶å‘å¹‚ç­‰ä¸è¿œç«¯ä¸€è‡´æ€§å¤„ç†ï¼ŒåŒæ—¶æ”¯æŒæ—¶åŒºä¸æ—¥æœŸæ ¼å¼å¯é…ç½®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“… æŒ‰æ—¥æœŸç”Ÿæˆç‰ˆæœ¬æ ‡ç­¾ï¼ˆå¦‚ï¼š`release_2024_01_15_v1`ï¼‰
- ğŸ”¢ è‡ªåŠ¨é€’å¢æ¯æ—¥ç‰ˆæœ¬å·ï¼ˆå½“æ—¥é¦–ä¸ªä¸º v1ï¼Œåç»­é€’å¢ï¼‰
- ğŸ·ï¸ åˆ›å»ºå¹¶æ¨é€æ ‡ç­¾åˆ°è¿œç«¯ä»“åº“
- ğŸŒ å¯é…ç½®æ—¶åŒºï¼ˆtzï¼‰ä¸æ—¥æœŸæ ¼å¼ï¼ˆdate_formatï¼‰
- ğŸ›¡ï¸ å¹¶å‘ä¸å¹‚ç­‰å¢å¼ºï¼šè¿œç«¯/æœ¬åœ°å­˜åœ¨æ€§æ£€æŸ¥ï¼Œé¿å…å¹¶è¡Œå†²çª
- ğŸŒ¿ å‰ç¼€ä¸ºç©ºæ—¶è‡ªåŠ¨å›é€€åˆ°è§¦å‘åˆ†æ”¯åï¼ˆ`${{ github.ref_name }}`ï¼‰
- ğŸ§° ç§»é™¤å¯¹ Node/npm çš„ä¾èµ–ï¼Œä»…éœ€ git ç¯å¢ƒ

## ä½¿ç”¨æ–¹æ³•

```yaml
name: Build and Tag

permissions:
  contents: write

on:
  push:
    branches: [main, master]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Build and tag
        uses: chengzao/github-toolkit-actions/build-tag@main
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          prefix: 'release'           # å¯é€‰ï¼Œé»˜è®¤ 'release'ï¼›ä¸ºç©ºåˆ™å›é€€ä¸ºè§¦å‘åˆ†æ”¯å
          tz: 'UTC'                   # å¯é€‰ï¼Œé»˜è®¤ 'UTC'ï¼›ä¾‹å¦‚ 'Asia/Shanghai'
          date_format: '%Y_%m_%d'     # å¯é€‰ï¼Œé»˜è®¤ '%Y_%m_%d'
          git_user_name: 'Your Name'  # å¯é€‰ï¼Œé»˜è®¤ 'github-actions'
          git_user_email: 'your.email@example.com' # å¯é€‰ï¼Œé»˜è®¤ 'github-actions@github.com'
```

## è¾“å…¥å‚æ•°

| å‚æ•° | æè¿° | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ |
|------|------|----------|--------|
| `token` | GitHub tokenï¼Œç”¨äºåˆ›å»ºå¹¶æ¨é€æ ‡ç­¾ | æ˜¯ | - |
| `prefix` | ç”¨äºæ ‡ç­¾åç§°çš„å‰ç¼€ï¼ˆä¸ºç©ºæ—¶å›é€€åˆ°è§¦å‘åˆ†æ”¯åï¼‰ | å¦ | `'release'` |
| `git_user_name` | Git ç”¨æˆ·åç§°ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’ç»™ git config | å¦ | `'github-actions'` |
| `git_user_email` | Git ç”¨æˆ·é‚®ç®±ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’ç»™ git config | å¦ | `'github-actions@github.com'` |
| `tz` | ç”Ÿæˆæ—¥æœŸæ—¶ä½¿ç”¨çš„æ—¶åŒºï¼ˆä¾‹å¦‚ï¼š`UTC`ã€`Asia/Shanghai`ï¼‰ | å¦ | `'UTC'` |
| `date_format` | æ—¥æœŸæ ¼å¼ï¼ˆstrftimeï¼‰ï¼Œä¾‹å¦‚ï¼š`%Y_%m_%d` | å¦ | `'%Y_%m_%d'` |

## è¾“å‡ºå‚æ•°

| è¾“å‡ºå | æè¿° | å¯èƒ½å€¼ |
|--------|------|--------|
| `tag_name` | åˆ›å»ºçš„æ ‡ç­¾åç§° | æ ‡ç­¾åç§°å­—ç¬¦ä¸²ï¼ˆå¦‚ï¼š`release_2024_01_15_v1`ï¼‰<br>åˆ›å»ºå¤±è´¥æ—¶ä¸ºç©ºå­—ç¬¦ä¸² |
| `tag_created` | æ ‡ç­¾æ˜¯å¦æˆåŠŸåˆ›å»ºå¹¶æ¨é€ | `true` - æ ‡ç­¾æˆåŠŸåˆ›å»ºå’Œæ¨é€<br>`false` - æ ‡ç­¾å·²å­˜åœ¨æˆ–åˆ›å»º/æ¨é€å¤±è´¥ |

## ä½¿ç”¨è¾“å‡ºå‚æ•°

ä½ å¯ä»¥åœ¨åç»­æ­¥éª¤ä¸­ä½¿ç”¨è¿™äº›è¾“å‡ºå‚æ•°æ¥æ‰§è¡Œæ¡ä»¶æ“ä½œï¼š

```yaml
- name: Build and tag
  id: build_tag
  uses: chengzao/github-toolkit-actions/build-tag@main
  with:
    token: ${{ secrets.GITHUB_TOKEN }}
    prefix: 'main'
    tz: 'Asia/Shanghai'
    date_format: '%Y_%m_%d'

- name: Use tag output
  run: |
    echo "åˆ›å»ºçš„æ ‡ç­¾: ${{ steps.build_tag.outputs.tag_name }}"
    
    if [ "${{ steps.build_tag.outputs.tag_created }}" = "true" ]; then
      echo "âœ… æ ‡ç­¾åˆ›å»ºå¹¶æ¨é€æˆåŠŸ"
      # åœ¨è¿™é‡Œæ·»åŠ æ ‡ç­¾åˆ›å»ºæˆåŠŸåçš„é€»è¾‘
      # ä¾‹å¦‚ï¼šè§¦å‘å‘å¸ƒæµç¨‹ã€å‘é€é€šçŸ¥ç­‰
    else
      echo "âš ï¸ æ ‡ç­¾å·²å­˜åœ¨æˆ–åˆ›å»ºå¤±è´¥"
      # åœ¨è¿™é‡Œæ·»åŠ æ ‡ç­¾å·²å­˜åœ¨/å¤±è´¥æ—¶çš„é€»è¾‘
    fi
```

## è¾“å‡ºå‚æ•°è¯¦ç»†è¯´æ˜

- `tag_name`: å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæˆåŠŸåˆ›å»ºçš„æ ‡ç­¾åç§°
  - æ ¼å¼ï¼š`${prefix}_${YYYY}_${MM}_${DD}_v${version}`
  - æ—¥æœŸç”± `tz` ä¸ `date_format` æ§åˆ¶ï¼Œé»˜è®¤ä¸º UTC å’Œ `%Y_%m_%d`
  - å½“åˆ›å»ºå¤±è´¥æ—¶ï¼Œè¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²
  - å¯ç”¨äºåç»­æ­¥éª¤ä¸­çš„æ ‡ç­¾å¼•ç”¨æˆ–é€šçŸ¥

- `tag_created`: å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ ‡ç­¾åˆ›å»º/æ¨é€æ“ä½œçš„çŠ¶æ€
  - å½“æ ‡ç­¾æˆåŠŸåˆ›å»ºå¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“æ—¶ï¼Œå€¼ä¸º `true`
  - å½“æ ‡ç­¾å·²å­˜åœ¨ã€åˆ›å»ºæ ‡ç­¾å¤±è´¥æˆ–æ¨é€å¤±è´¥æ—¶ï¼Œå€¼ä¸º `false`
  - å»ºè®®ä½¿ç”¨æ­¤å‚æ•°è¿›è¡Œæ¡ä»¶åˆ¤æ–­æ¥å†³å®šåç»­æ“ä½œ

## æ ‡ç­¾å‘½åè§„åˆ™

ç”Ÿæˆçš„æ ‡ç­¾æ ¼å¼ä¸ºï¼š`${prefix}_${YYYY}_${MM}_${DD}_v${version}`

ä¾‹å¦‚ï¼š
- `release_2024_01_15_v1`
- `main_2024_01_15_v2`

## ç‰ˆæœ¬é€’å¢é€»è¾‘

- æ¯å¤©ä» v1 å¼€å§‹
- å¦‚æœå½“å¤©å·²æœ‰æ ‡ç­¾ï¼Œåˆ™é€’å¢ç‰ˆæœ¬å·ï¼ˆåŸºäºè¿œç«¯/æœ¬åœ°æœ€æ–°æ ‡ç­¾ï¼‰
- ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ’åº `sort -V` é€‰æ‹©æœ€æ–°ç‰ˆæœ¬å·

## ä¾èµ–è¦æ±‚

- éœ€è¦ Git ä»“åº“é…ç½®
- éœ€è¦é…ç½® Git ç”¨æˆ·ä¿¡æ¯
- éœ€è¦é…ç½® Token ä»¥å…è®¸æ¨é€æ ‡ç­¾
- ä¸éœ€è¦ Node.js æˆ– npm ç¯å¢ƒ

## æœ¬åœ°å¼€å‘

åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼•ç”¨ï¼š

```yaml
uses: ./build-tag
```

## è®¸å¯è¯

MIT License